"use strict";(self.webpackChunkminetrax_github_io=self.webpackChunkminetrax_github_io||[]).push([[5299],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return u}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=c(n),u=o,h=m["".concat(p,".").concat(u)]||m[u]||d[u]||r;return n?a.createElement(h,i(i({ref:t},l),{},{components:n})):a.createElement(h,i({ref:t},l))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},25:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return p},default:function(){return u},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return d}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],s={sidebar_position:5,title:"WebSocket Options",id:"websocket-options"},p=void 0,c={unversionedId:"web/websocket-options",id:"web/websocket-options",title:"WebSocket Options",description:"It is recommended you keep running Pusher and switch to alternative methods only if Pusher free plan doesn't meet your needs.",source:"@site/docs/web/websocket-options.md",sourceDirName:"web",slug:"/web/websocket-options",permalink:"/docs/web/websocket-options",draft:!1,editUrl:"https://github.com/minetrax/minetrax.github.io/edit/main/docs/web/websocket-options.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"WebSocket Options",id:"websocket-options"},sidebar:"tutorialSidebar",previous:{title:"SMTP Configuration",permalink:"/docs/web/smtp-configuration"},next:{title:"Installing Plugin",permalink:"/docs/plugin/installing-plugin"}},l={},d=[{value:"Laravel Websockets",id:"laravel-websockets",level:2},{value:"Start the websocket server",id:"start-the-websocket-server",level:3},{value:"Running in SuperVisor",id:"running-in-supervisor",level:4},{value:"Change broadcasting configuration",id:"change-broadcasting-configuration",level:3},{value:"Change frontend asset settings",id:"change-frontend-asset-settings",level:3},{value:"Rebuild assets &amp; restart services",id:"rebuild-assets--restart-services",level:3},{value:"Socketi",id:"socketi",level:2}],m={toc:d};function u(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Try pusher first")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"It is recommended you keep running Pusher and switch to alternative methods only if Pusher free plan doesn't meet your needs."))),(0,r.kt)("p",null,"In the Getting Started section we setup ",(0,r.kt)("a",{parentName:"p",href:"https://pusher.com"},"Pusher")," as our websocket server."),(0,r.kt)("p",null,"Pusher free tier provides 200k push messages per day and 100 concurrent connections. This might not be enough when your audience is large. Ofcoz you can opt for paid plan of Pusher to remove these limitations but that might get costly."),(0,r.kt)("p",null,"Here we are going to discuss about two self-hosted alternatives which won't have any limitations and support pusher protocol."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://beyondco.de/docs/laravel-websockets/"},"Laravel Websockets")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://docs.soketi.app/"},"Socketi"))),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You need to install only of them in your server."))),(0,r.kt)("h2",{id:"laravel-websockets"},"Laravel Websockets"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Visit Laravel Websocket docs for detailed explanation: ",(0,r.kt)("a",{parentName:"p",href:"https://beyondco.de/docs/laravel-websockets/"},"https://beyondco.de/docs/laravel-websockets/")))),(0,r.kt)("p",null,"Laravel Websockets server is already bundled with minetrax. To use it instead of pusher all you need to do is run the server and change your broadcasting configurations."),(0,r.kt)("h3",{id:"start-the-websocket-server"},"Start the websocket server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd /var/www/minetrax\nphp artisan websockets:serve\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"By default websocket server start on port 6001. You can change that by specifying port."),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre"},"php artisan websockets:serve --port=3030\n")))),(0,r.kt)("h4",{id:"running-in-supervisor"},"Running in SuperVisor"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"websockets:serve")," should always be running to accept connection. This is why it is recommended to use supervisor to keep it running and automatically restart on crashes."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Break the websocket server daemon by pressing ",(0,r.kt)("inlineCode",{parentName:"em"},"Ctrl+C")," if its running, and follow the steps below to use it with supervisor.")),(0,r.kt)("p",null,"Create a new supervisor conf file in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/supervisor/conf.d")," folder called ",(0,r.kt)("inlineCode",{parentName:"p"},"minetrax-websocket.conf")," and paste below content in there."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=/etc/supervisor/conf.d/minetrax-websocket.conf",title:"/etc/supervisor/conf.d/minetrax-websocket.conf"},"[program:minetrax-websockets]\ncommand=/usr/bin/php /var/www/minetrax/artisan websockets:serve\nnumprocs=1\nautostart=true\nautorestart=true\nuser=www-data\n")),(0,r.kt)("p",null,"Update the supervisor and start the daemon"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"supervisorctl update\nsupervisorctl start minetrax-websockets\n")),(0,r.kt)("h3",{id:"change-broadcasting-configuration"},"Change broadcasting configuration"),(0,r.kt)("p",null,"You need to add ",(0,r.kt)("inlineCode",{parentName:"p"},"host")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"port")," config key in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config/broadcasting.php")," and add it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"pusher")," section. The default port of the Laravel WebSocket server is 6001"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:"title='config/broadcasting.php'",title:"'config/broadcasting.php'"},"'pusher' => [\n    'driver' => 'pusher',\n    'key' => env('PUSHER_APP_KEY'),\n    'secret' => env('PUSHER_APP_SECRET'),\n    'app_id' => env('PUSHER_APP_ID'),\n    'options' => [\n        'cluster' => env('PUSHER_APP_CLUSTER'),\n        'encrypted' => true,\n        'host' => '127.0.0.1',\n        'port' => 6001,\n        'scheme' => 'http'\n    ],\n],\n\n")),(0,r.kt)("h3",{id:"change-frontend-asset-settings"},"Change frontend asset settings"),(0,r.kt)("p",null,"Minetrax uses npm package called ",(0,r.kt)("inlineCode",{parentName:"p"},"Echo")," for listening to broadcasts.\nTo make Echo work with Laravel WebSockets, you need to make slight adjustments in ",(0,r.kt)("inlineCode",{parentName:"p"},"resources/js/bootstrap.js")," file."),(0,r.kt)("p",null,"In Echo section of the file add ",(0,r.kt)("inlineCode",{parentName:"p"},"wsHost"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"wsPort"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"disableStats")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"forceTLS")," as given below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"window.Echo = new Echo({\n    broadcaster: 'pusher',\n    key: 'your-pusher-key',\n    // highlight-start\n    wsHost: window.location.hostname,\n    wsPort: 6001,\n    forceTLS: false,\n    disableStats: true\n    // highlight-end\n});\n")),(0,r.kt)("h3",{id:"rebuild-assets--restart-services"},"Rebuild assets & restart services"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd /var/www/minetrax\n\nnpm install\nnpm run prod\n\nphp artisan queue:restart\nsupervisorctl restart minetrax-websockets\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"For SSL support please read: ",(0,r.kt)("a",{parentName:"p",href:"https://beyondco.de/docs/laravel-websockets/basic-usage/ssl"},"https://beyondco.de/docs/laravel-websockets/basic-usage/ssl")))),(0,r.kt)("h2",{id:"socketi"},"Socketi"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Visit soketi docs for detailed explanation: ",(0,r.kt)("a",{parentName:"p",href:"https://docs.soketi.app/"},"https://docs.soketi.app/")))),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Docs In Progress")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you want to use Socketi, for now you can follow their official docs ",(0,r.kt)("a",{parentName:"p",href:"https://docs.soketi.app/getting-started/installation/cli-installation"},"here")))))}u.isMDXComponent=!0}}]);